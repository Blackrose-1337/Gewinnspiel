import{c as q,r as x,ba as B,Z as E,_ as F,ad as I,h as Q,j as _,k as R,s as z,ae as Z,aU as L,bb as $,m as M,t as T,K as U,J as j,I as K,n as N,B as O,C as A,bc as D,v as g,an as S,Q as J,z as G,q as H}from"./index.2f8d8692.js";var W=q({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validation-success","validation-error"],setup(n,{slots:V,emit:p}){const i=R(),l=x(null);let r=0;const a=[];function u(e){const t=[],h=typeof e=="boolean"?e:n.noErrorFocus!==!0,C=++r,w=(f,s)=>{p("validation-"+(f===!0?"success":"error"),s)};for(let f=0;f<a.length;f++){const s=a[f],v=s.validate();if(typeof v.then=="function")t.push(v.then(d=>({valid:d,comp:s}),d=>({valid:!1,comp:s,err:d})));else if(v!==!0){if(n.greedy===!1)return w(!1,s),h===!0&&typeof s.focus=="function"&&s.focus(),Promise.resolve(!1);t.push({valid:!1,comp:s})}}return t.length===0?(w(!0),Promise.resolve(!0)):Promise.all(t).then(f=>{const s=f.filter(k=>k.valid!==!0);if(s.length===0)return C===r&&w(!0),!0;const{valid:v,comp:d,err:P}=s[0];return C===r&&(P!==void 0&&console.error(P),w(!1,d),h===!0&&v!==!0&&typeof d.focus=="function"&&d.focus()),!1})}function c(){r++,a.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function y(e){e!==void 0&&z(e);const t=r+1;u().then(h=>{t===r&&h===!0&&(n.onSubmit!==void 0?p("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function b(e){e!==void 0&&z(e),p("reset"),Z(()=>{c(),n.autofocus===!0&&n.noResetFocus!==!0&&m()})}function m(){L(()=>{if(l.value===null)return;const e=l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),t=>t.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}B($,{bindComponent(e){a.push(e)},unbindComponent(e){const t=a.indexOf(e);t>-1&&a.splice(t,1)}});let o=!1;return E(()=>{o=!0}),F(()=>{o===!0&&n.autofocus===!0&&m()}),I(()=>{n.autofocus===!0&&m()}),Object.assign(i.proxy,{validate:u,resetValidation:c,submit:y,reset:b,focus:m,getValidationComponents:()=>a}),()=>Q("form",{class:"q-form",ref:l,onSubmit:y,onReset:b},_(V.default))}});const X=H("span",{class:"text-h5"},"Login",-1),ee=M({props:{redirectTo:{type:String,default:"/"}},setup(n){const V=n,{redirectTo:p}=T(V),i=U(),l=j(),r=K(),a=x(""),u=x(""),c=x(!1);function y(o){return/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,7}$/.test(o)||"Invalid email"}function b(o){return/^[a-zA-Z0-9\@\+\?\!]{12,20}$/.test(o)||"Invalid password"}async function m(){if(y(a.value)!=!0)i.notify({message:"Email ist inakzeptabel",type:"negative"});else if(b(u.value)!=!0)i.notify({message:"Passwort ist inakzeptabel",type:"negative"});else try{const o=await l.login(a.value,u.value);o===!0?(i.notify({message:"Login aktzeptiert",type:"positive"}),await r.push(p.value)):(i.notify({message:o.error,type:o.success}),l.role=o.role,await r.push(p.value))}catch(o){console.error("Login failed: ",o),i.notify({message:`Login fehlgeschlagen
`,type:"negative"})}}return(o,e)=>(N(),O(D,{class:"q-pa-xl"},{default:A(()=>[X,g(W,{ref:"form"},{default:A(()=>[g(S,{label:"E-Mail",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t),type:"email",autofocus:"","lazy-rules":"",rules:[t=>t&&t.length>0||"E-Mail is required"]},null,8,["modelValue","rules"]),g(S,{label:"Password",modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),type:c.value?"text":"password",rules:[t=>t&&t.length>0||"Password is required"]},{append:A(()=>[g(J,{name:c.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:e[1]||(e[1]=t=>c.value=!c.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),g(G,{label:"Login",class:"q-mt-auto",color:"primary",icon:"login",onClick:m})]),_:1},512)]),_:1}))}});export{ee as default};
